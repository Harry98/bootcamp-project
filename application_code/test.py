import os

from atlassian import Confluence

from graph_state import RAGState
from agents import agent_3_confluence_filter_pages, agent_1_generate_cql, agent_4_vector_db_filter_records, \
    agent_2_search_vector_db
import asyncio
from dotenv import load_dotenv
from agents_helper import search_confluence_with_cql_queries, get_tools

load_dotenv()

confluence = Confluence(
    url=os.getenv("CONFLUENCE_URL"),
    username=os.getenv("CONFLUENCE_ACCOUNT"),
    password=os.getenv("CONFLUENCE_TOKEN"),
    cloud=True)


def test_search_confluence():
    query = 'siteSearch ~ "Maple trust bank"'
    result = confluence.cql(query)
    print(result)


def test_agent_4_confluence_review_agent():
    dummy_state = RAGState(
        session_id="testing",
        user_query="What is DMS?",
        confluence_response=[
            {'page_id': '3014164585', 'title': 'DMS Core Service',
             'matched_content': 'Allowed File Extensions for Document Upload\nOnly following document extension types are allowed in @@@hl@@@DMS@@@endhl@@@ Core to be uploaded.\n    PDF(&quot;.pdf&quot;, &quot;application/pdf&quot;),\n    DOCX(&quot;.docx...-officedocument.presentationml.presentation&quot;);\n@@@hl@@@DMS@@@endhl@@@ Request-Response\nPOST Request - Upload Document By Streaming - /v1/shareping/blob/stream\nRequest\nRequest Structure!--https',
             'page_url': '/spaces/SA/pages/3014164585/DMS+Core+Service', 'lastModified': '2025-05-09T13:11:04.000Z',
             'match_score': 35.939236},
            {'page_id': '3199762434', 'title': 'DMS - Audit',
             'matched_content': 'Overview\nThe Orbit document migration project involves migrating documents from an existing document management system (Orbit) to a new custom solution (@@@hl@@@DMS@@@endhl@@@) and Sharepoint Sites... includes:\nDocument types and formats to be migrated.\nSource and target systems [ @@@hl@@@DMS@@@endhl@@@ &amp; Sharepoint ].\nRoles and responsibilities of stakeholders involved in the migration.\nDuration',
             'page_url': '/spaces/SA/pages/3199762434/DMS+-+Audit', 'lastModified': '2024-05-10T15:44:23.000Z',
             'match_score': 33.439625},
            {'page_id': '3776315396', 'title': 'SharePoint Service to DMS',
             'matched_content': ', and the corresponding files in SharePoint will be deleted.\nAll APIs will be provided through @@@hl@@@DMS@@@endhl@@@, and the SharePoint service will be decommissioned.\nFollow-up documents are generated...-SVC@omers.onmicrosoft.com\nCurrent flow with sharepoint-service\nNew flow with @@@hl@@@dms@@@endhl@@@-core-service\nDocument transfer process\nMetadata',
             'page_url': '/spaces/SA/pages/3776315396/SharePoint+Service+to+DMS',
             'lastModified': '2025-05-29T22:44:02.000Z', 'match_score': 33.315857},
            {'page_id': '3206774822', 'title': 'DMS - Sharepoint',
             'matched_content': 'Overview\n@@@hl@@@DMS@@@endhl@@@ Core service exposes endpoint for Sharepoint Online integration. These endpoints can be used in following ways\nTo upload documents into Sharepoint site, with metadata...)\nThis use case is their for uploading file into Sharepoint for Donna S&amp;D service. @@@hl@@@DMS@@@endhl@@@ will be updated with this feature in coming months.\nSharepoint Upload Without Metadata\nCurrently',
             'page_url': '/spaces/SA/pages/3206774822/DMS+-+Sharepoint', 'lastModified': '2024-05-01T01:11:22.000Z',
             'match_score': 33.285553}
        ],
        filtered_pages=[],
        vector_db_response=[],
        answer="",
        cql_queries=[]
    )
    print(asyncio.run(agent_3_confluence_filter_pages(state=dummy_state)))


def test_agent_1_generate_cql():
    dummy_state = RAGState(
        session_id="testing",
        user_query="Tell me about Maple trust bank?",
        confluence_response=[],
        filtered_pages=[],
        vector_db_response=[],
        answer="",
        cql_queries=[]
    )
    print(asyncio.run(agent_1_generate_cql(state=dummy_state)))


def test_agent_2_search_vector_db():
    dummy_state = RAGState(
        session_id="testing",
        user_query="Tell me about Maple trust bank?",
        confluence_response=[],
        filtered_pages=[],
        vector_db_response=[],
        answer="",
        cql_queries=[]
    )
    print(asyncio.run(agent_2_search_vector_db(state=dummy_state)))

def test_agent4_vector_db_filter():
    mock_response = [
            {
                "page_id": "2097208",
                "title": "2097208_Documentation Roadmap for Advanced Finance, Risk & Operations at Maple Trust Bank",
                "matched_content": "Title of the page is Documentation Roadmap for Advanced Finance, Risk & Operations at Maple Trust Bank \n \n Page Created by: Kartik Sharma\n Page Last edited by: Kartik Sharma\n and markdown of the page is \n ## 1\\. Quick‐Links Directory\nUse _Ctrl + Click_ (or _Cmd + Click_ on macOS) to open placeholders in new\ntabs once pages are created.\n| Page Title| SME / Team| Status \n---|---|---|--- \n1| Risk‐Weighted Asset Methodology| Credit Risk & Basel Compliance| Draft \n2| Treasury & Liquidity Playbook| Treasury / ALM| Draft \n3| Market‐Risk Limits & VaR Models| Trading Risk| Draft \n4| Capital Planning & ICAAP| Enterprise Risk| Draft \n5| Regulatory Change Tracker| Compliance| Draft \n6| Cybersecurity & Data‐Privacy Controls| InfoSec / Privacy| Draft \n7| Model Inventory & Validation Schedule| Model Risk| Draft \n8| Operational‐Risk Loss Database| OpRisk| Draft \n9| Deposit Pricing Strategy| Retail Deposits| Draft \n10| Green & Sustainable Finance Framework| ESG Office| Draft \n11| API & Integration Portal| Digital Banking| Draft \n12| Customer Onboarding Workflow| Retail Ops / KYC| Draft \n13| Branch & ATM Optimization Dashboard| Channel Strategy| Draft \n \n *\n2\\. Detailed Descriptions\nPurpose \nDocument PD/LGD/EAD grids, correlation matrices, and Pillar 1 vs Pillar 2\nadd‐ons to ensure transparent RWA calculations.\nKey Sections\n * Basel framework overview\n * Calculation logic & equations\n * Data sources & quality controls\n * Model performance KPIs\n * Update frequency & governance\nOwner: Credit Risk Analytics\n *\n * Funding stack (capital markets vs deposits)\n * Liquidity buffer targets (LCR ≥ 105 %, NSFR ≥ 110 %)\n * Stressed cash‐flow projections\n * Contingency funding plan & triggers\n _Owner:_ Treasury / ALM\n *\n * Trading‐book limit matrix and hierarchy\n * Historical / Monte‐Carlo VaR & Expected Shortfall methods\n * Back‐testing and exception handling workflow\n _Owner:_ Market Risk Management\n *\n * Scenario design (macro, idiosyncratic, reverse)\n * Capital waterfall & buffers (CET1, AT1, Tier 2)\n * Management action catalogue\n _Owner:_ Enterprise Risk & Capital Strategy\n *\n * OSFI & Basel bulletins timeline\n * Impact assessment matrix (people, process, tech)\n * Implementation tasks & owners\n _Owner:_ Regulatory Compliance\n *\n * CIS control mapping\n * PIPEDA & GDPR obligations\n * Incident‐response runbooks and RACI\n _Owner:_ Information Security & Privacy Office\n *\n * Master list of all risk/finance models\n * Materiality tiers & validation cadence\n * Upcoming review calendar\n _Owner:_ Model Risk Management\n *\n * Internal loss event log & taxonomy\n * Root‐cause analyses & remediation actions\n * Key Risk Indicators (KRIs) dashboard\n _Owner:_ Operational Risk\n *\n * Funds‐transfer pricing credits\n * Competitor rate benchmarking\n * Elasticity & attrition curves\n * Promo campaign playbook\n _Owner:_ Retail Deposits Product Team\n *\n * Eligible asset taxonomy (e.g., EV loans, green buildings)\n * Impact KPIs & reporting templates\n * Second‐party opinion/assurance process\n _Owner:_ ESG & Sustainable Finance Office\n *\n * OAuth 2.0 / OpenID flows\n * Endpoint specs (accounts, payments, FX)\n * Sandbox credentials & test data\n _Owner:_ Digital Banking Technology\n *\n * End‐to‐end KYC/KYB process maps\n * Screening & adverse‐media tools\n * Turnaround time (TAT) SLAs and exceptions queue\n _Owner:_ Retail Operations & AML\n *\n * Foot‐traffic heat maps\n * Cash utilization metrics\n * Closure/expansion thresholds and decision rules\n _Owner:_ Channel Strategy & Analytics\n *\n3\\. ️ Implementation Steps\n 1. Confirm Owners: Each team assigns a page steward.\n 2. Create Page Templates: Use the _Finance -Risk Template Pack_ for consistent look & feel.\n 3. Populate MVP Content: At minimum, include purpose statement, outline, and \"Next Steps\" section.\n 4. Link Back Here: Add a backlink to this roadmap on every new page.\n 5. Review Cycle: Quarterly refresh via Content Committee.\n *\n4\\. ️ Quarterly Content Timeline\nQuarter| Pages to Finalize| Review Lead \n---|---|--- \nQ3 2025| 1, 2, 5| CFO Office \nQ4 2025| 3, 4, 6, 7| CRO Office \nQ1 2026| 8, 9, 10| COO Office \nQ2 2026| 11, 12, 13| CIO Office \n \n *\n5\\. Governance & Access\n * Pages restricted to Finance‐Risk space; edit rights limited to page owners.\n * Versioning: Enable _Page History_ and mandatory change comments.\n * Annual audit by Internal Audit to verify content accuracy and ownership.\n *\n> _For questions or to suggest additional documentation,\n> contactconfluence‐_[\n> _admin@mapletrustbank.ca_](mailto:admin@mapletrustbank.ca) _or raise a\n> ticket in the \"Knowledge Management\" Jira project._"
            },
            {
                "page_id": "2097163",
                "title": "2097163_Financial Aspects and Services Overview",
                "matched_content": "Title of the page is Financial Aspects and Services Overview \n \n Page Created by: Kartik Sharma\n Page Last edited by: Kartik Sharma\n and markdown of the page is \n # Maple Trust Bank\n *\n1\\. Introduction\nMaple Trust Bank is a full-service Canadian financial institution offering\na wide range of personal, business, and digital banking services. With a\nstrong national presence, the bank is committed to empowering individuals,\nfamilies, and enterprises with accessible and secure financial solutions.\n *\n2\\. Core Financial Products\n2.1 Personal Banking\nProduct| Description \n---|--- \nChequing Accounts| Flexible day-to-day transaction accounts with competitive\nfees and Interac support \nSavings Accounts| Interest-bearing accounts with tiered rates based on balance\nlevels \nCredit Cards| Options include cashback, travel rewards, and low-interest cards \nPersonal Loans| Fixed or variable rate loans tailored to personal financial\ngoals \nLines of Credit| Revolving credit lines for flexible borrowing \nMortgages| Fixed and variable rate mortgages, including insured and\nconventional plans \n \n2.2 Business Banking\nProduct| Description \n---|--- \nBusiness Chequing Accounts| Customized for different volumes and business\nneeds \nBusiness Loans| Term financing for equipment, growth, or operations \nCommercial Mortgages| Real estate financing for business use \nMerchant Services| POS solutions, payment processing, and invoicing support \n \n2.3 Investment & Wealth Management\nProduct| Description \n---|--- \nRRSP / TFSA / RESP / RDSP| Registered accounts for retirement, savings,\neducation, and disabilities \nMutual Funds| Professionally managed investment portfolios \nGICs| Guaranteed returns with fixed-term deposits \nFinancial Advisory Services| Personalized wealth management and planning \n \n *\n3\\. ️ Insurance Products\nType| Coverage Areas \n---|--- \nLife Insurance| Comprehensive term and permanent life coverage options \nHome & Auto Insurance| Bundled policies, accident protection, and roadside\nservices \nTravel Insurance| Emergency medical, trip cancellation, and baggage protection \nCredit Protection| Coverage for loan and credit repayments during unforeseen\nevents \n \n *\n4\\. Digital Banking Services\n4.1 Online & Mobile Banking\n * 24/7 access to all accounts and services\n * Interac e-Transfers, bill payments, e-statements\n * Mobile cheque deposit\n * Multi-factor authentication and account alerts\n4.2 Additional Features\n * Budgeting and goal tracking tools\n * Real-time investment portfolio insights\n * Smart chatbot and virtual assistant support\n *\n5\\. Branch & ATM Network\n * Over 400 branches across all Canadian provinces\n * 2,000+ ATMs with surcharge-free withdrawals\n * In-branch advisors for personal and business consultations\n *\n6\\. Fees & Interest Overview\nService| Typical Fee/Rate \n---|--- \nChequing Account Fee| $0-$16.95/month depending on plan \nInterac e-Transfer| Free to $1.50 per transfer \nCredit Card APR| 13.99% - 19.99% \nGIC Interest (1 Year)| 4.00% \nMortgage Rate (5 Year Fixed)| 5.29% \n \n_Fees and rates subject to change._\n *\n7\\. ‍ Customer Support Channels\n * 24/7 phone support: 1-800-MAPLE-TR\n * Live chat via mobile and desktop\n * Bookable appointments with advisors\n * Accessibility support including TTY, screen readers, and language interpretation\n *\n8\\. Security & Compliance\n * Adherence to FINTRAC, OSFI, and PIPEDA standards\n * End-to-end encrypted transactions\n * Real-time fraud alerts and identity protection\n * Regular third-party audits and security testing\n *\n9\\. ESG & Community Engagement\n * Carbon-neutral initiatives and green banking programs\n * Sponsorship of community outreach and literacy programs\n * Indigenous banking partnerships and tailored services\n * Employee volunteerism and charitable giving programs\n *"
            },
            {
                "page_id": "1966120",
                "title": "1966120_Business Banking",
                "matched_content": "Title of the page is Business Banking \n \n Page Created by: Kartik Sharma\n Page Last edited by: Kartik Sharma\n and markdown of the page is \n *\n1\\. Introduction\nMaple Trust Bank's Business Banking Solutions are designed to support\ncompanies of all sizes and industries with tailored financial products,\nservices, and advisory support. From daily cash flow management to growth\nfinancing and point‐of‐sale integration, we help businesses operate smoothly\nand seize opportunities.\n *\n2\\. Business Chequing Accounts\nAccount Tier| Monthly Fee| Transaction Allowance| Key Features \n---|---|---|--- \nStarter| $0| 50 transactions| No monthly fee, basic online banking, free\nInterac e‐Transfers \nGrowth| $14.95| 150 transactions| Automated sweep to savings, overdraft\nprotection, mobile deposits \nEnterprise| $29.95| Unlimited| Dedicated relationship manager, custom\nreporting, priority support \n \n * Automated Sweep: Excess balances in chequing can sweep into a high‐interest business savings account overnight.\n * Overdraft Protection: Linked line of credit up to pre‐approved limit for temporary cash shortfalls.\n * Custom Reporting: Downloadable reports, CSV exports, and integration with popular accounting software (e.g., QuickBooks, Xero).\n *\n3\\. Business Lending\nLoan Type| Purpose| Terms & Rates \n---|---|--- \nTerm Loans| Purchase equipment, expansion, capex| $25,000-$5M; fixed or\nvariable rates; 1-10 years \nLines of Credit| Seasonal cash flow, working capital| Up to $500K; prime\n+ 1.00%; revolving access \nCommercial Mortgages| Purchase or refinance commercial real estate| Up to\n75% LTV; amortization up to 25 years; variable or fixed \nAsset Financing (Leases)| Equipment or vehicle leasing| Leasing term up\nto 7 years; 100% financing options \n \n 1. Pre‐qualification: Quick eligibility check with no impact to credit score.\n 2. Documentation: Consolidated package including financial statements and business plan.\n 3. Decision Timeline: Term loan decisions within 3-5 business days.\n 4. Dedicated Officer: A single point of contact for structuring and disbursement.\n *\n4\\. Cash Management Services\n * Automated Clearing House (ACH): Batch payment processing for payroll, vendor payments.\n * Wire Transfers: Domestic and international wires with competitive FX rates.\n * Zero‐Balance Accounts: Centralize funds and eliminate idle balances.\n * Lockbox Services: Improve receivables processing by having payments sent directly to a secured lockbox.\n * Positive Pay & Fraud Controls: Automated check‐fraud detection, email alerts for exceptions.\n *\n5\\. Merchant Services\nService| Features \n---|--- \nPOS Terminals| Chip & PIN, contactless NFC, mobile/swipe readers \nPayment Gateway| API integration for e‐commerce, recurring billing\nsupport \nVirtual Terminal| Process card‐not‐present transactions via secure portal \nMobile Payments| Apple Pay, Google Pay, Samsung Pay integration \nSettlement & Reporting| Next‐day settlement, detailed transaction\nanalytics \n \n *\n6\\. Industry‐Specific Offerings\n6.1 Retail & E‐Commerce\n * Dynamic Discounting: Early‐payment incentives for B2B suppliers.\n * Inventory Financing: Financing tied to inventory levels and turnover.\n6.2 Hospitality & Restaurants\n * Revenue‐Based Financing: Flexible repayments based on monthly sales.\n * Integrated POS Financing: Bundled hardware and financing for new location setups.\n6.3 Agriculture & Agribusiness\n * Seasonal Operating Lines: Align borrowing with planting/harvest cycles.\n * Equipment Loans: Deferred payment options until crop sale.\n6.4 Professional Services\n * Fee‐Based Lending: Loans secured by accounts receivable or contracts.\n * Client Trust Account Services: Segregated trust accounts with compliance reporting.\n *\n7\\. ️ Advisory & Support\n * Dedicated Relationship Manager: Personalized guidance on product selection and business strategy.\n * Online Business Resource Center: Webinars, whitepapers, and calculators for cash‐flow planning, budgeting, and risk management.\n * Integration Support: Assistance with API integration for cash‐management and merchant‐service platforms.\n *"
            },
            {
                "page_id": "1998908",
                "title": "1998908_Loan Products & Value Creation",
                "matched_content": "Title of the page is Loan Products & Value Creation \n \n Page Created by: Kartik Sharma\n Page Last edited by: Kartik Sharma\n and markdown of the page is \n ## 1\\. Introduction\nMaple Trust Bank offers a range of loan solutions designed to meet personal,\nhousehold, and business needs while maintaining sustainable profitability.\nEach product balances fair pricing for customers with prudent risk‐adjusted\nreturns for the bank, allowing us to reinvest in better services, digital\ninnovation, and community programs.\n *\n2\\. Personal & Consumer Loans\nLoan Type| Typical Purpose| Customer Benefits| Bank Value Creation* \n---|---|---|--- \n Personal Installment Loan| Debt consolidation, major purchases| Fixed\nrate, predictable payments; quick approval| Net Interest Margin (NIM) on\namortizing balance; modest origination fee \nAuto Loan| New or used vehicle financing| Competitive fixed rates;\npre‐approval at dealership| Partnership subsidies with dealers; cross‐sell\ninsurance \nLine of Credit (LoC)| Flexible short‐term borrowing| Interest charged\nonly on drawn amount; reusable limit| Variable‐rate spread above prime;\ncommitment fee on unused limit \nStudent Loan| Tuition, textbooks, living expenses| Interest subsidy while\nin school; flexible repayment| Long‐term relationship, graduate upsell to\nother products \nHome Equity Line of Credit (HELOC)| Renovations, large expenses| Lower\nrate secured by home equity; interest‐only option| Secured spread below\nunsecured LoC; collateral reduces credit losses \n \n * How the Bank Profits:\n \nProfit=(Interest Rate−Cost of Funds−Expected Loss)×Outstanding\nPrincipal+Fees\\displaystyle \\text{Profit} = (\\text{Interest Rate} - \\text{Cost\nof Funds} - \\text{Expected Loss}) \\times \\text{Outstanding Principal} +\n\\text{Fees}\n *\n3\\. Mortgage Lending\nProduct Variant| Key Features| Customer Benefits| Profit Drivers \n---|---|---|--- \nFixed‐Rate Mortgage| 1‐, 3‐, 5‐, or 10‐year terms| Payment stability|\nSpread locked for term; breakage fees \nVariable‐Rate Mortgage| Rate floats with prime (caps available)| Benefit\nif rates fall; convertible to fixed| Variable spread; lower duration risk \nCashback Mortgage| Lump‐sum cashback at funding| Up‐front funds for\nclosing costs| Slightly higher rate offsets cashback \nNewcomer & First‐Time Buyer Program| Reduced down‐payment, advice bundle|\nEasier entry into housing market| CMHC‐insured, minimizes credit risk \n \nEconomic Model: Mortgages create a long‐duration asset funded primarily by\nlow‐cost deposits, producing stable net interest income. Ancillary revenue:\nmortgage life insurance, homeowner's insurance referrals, and retention when\nclients renew.\n *\n4\\. Business & Commercial Lending\nFacility| Typical Use Case| Customer Benefits| Bank Profit Logic \n---|---|---|--- \nTerm Loan| Equipment purchase, expansion| Fixed amortization aligns with\nasset life| Asset‐backed collateral lowers LGD1 \nOperating Line| Working‐capital swings| Revolving credit; interest only\non used balance| Prime‐based pricing with standby fee on undrawn portion \nCommercial Mortgage| Office, retail, industrial property| Long\namortization, predictable payments| Real estate collateral; fee income for\nappraisals \nAgricultural Operating Loan| Seed, fertilizer, livestock feed| Seasonal\nrepayment aligned with harvest cycle| Government guarantee programs reduce\ncapital charges \nEquipment Leasing| Trucks, heavy machinery| 100 % financing; tax\ndeductibility| Residual asset value plus lease rate spread \n \n1LGD: Loss Given Default. Lower LGD increases risk‐adjusted return.\n *\n5\\. Responsible Profit Framework\n 1. Risk‐Based Pricing - Rates reflect probability of default (PD) and LGD, ensuring high‐credit customers pay less while higher‐risk loans remain sustainable.\n 2. Inclusive Access - Products like Student Loans and Newcomer Mortgages expand financial inclusion, forging long‐term relationships that generate lifetime value.\n 3. Cross‐Sell Synergy - Loans often introduce customers to savings, insurance, or investment products, diversifying revenue and boosting customer success.\n 4. Capital Efficiency - Careful balance‐sheet management (e.g., securitizing mortgages) frees capital for more lending, amplifying community impact.\n *\n6\\. Example Profit Calculation\n> Five‐Year Fixed Mortgage\n>\n> * Principal: $400,000\n>\n> * Rate: 5.29 %\n>\n> * Cost of Funds: 2.10 %\n>\n> * Expected Credit Loss: 0.12 %\n>\n> * Servicing & Capital Cost: 0.60 %\n>\n>\nNet Spread=5.29−2.10−0.12−0.60=2.47%\\text{Net Spread}=5.29-2.10-0.12-0.60 =\n2.47\\%\nAnnual profit ≈ $400,000 × 2.47 % = $9,880 (before tax). A portion funds\ndigital upgrades, branch services, and community outreach.\n *\n7\\. Community Impact\n * Local Job Creation: Lending to small businesses supports employment growth.\n * Financial Education: Loan officers provide budgeting guidance during origination.\n * Housing Affordability: First‐time buyer programs open doors to home ownership.\n * Green Financing: Preferential rates for energy‐efficient home upgrades and electric vehicle loans reduce carbon footprint.\n *\n> Questions about our lending programs? Speak with a Maple Trust Bank advisor\n> or call 1‐800‐MAPLE‐TR."
            },
            {
                "page_id": "1998898",
                "title": "1998898_Financial Literacy & Resources",
                "matched_content": "Title of the page is Financial Literacy & Resources \n \n Page Created by: Kartik Sharma\n Page Last edited by: Kartik Sharma\n and markdown of the page is \n ## 1\\. Introduction\nEmpowering our customers with knowledge is at the heart of Maple Trust Bank's\nmission. Explore our curated library of articles, calculators, and tutorials\ndesigned to help you budget effectively, build savings, manage credit\nresponsibly, and make informed investment decisions.\n *\n2\\. Articles & Guides\nAccess our Knowledge Base for in‐depth articles on:\n * Budgeting fundamentals\n * Building and maintaining an emergency fund\n * Understanding and improving credit scores\n * Debt‐reduction strategies\n * Investing basics and portfolio diversification\n * Retirement planning with RRSPs and TFSAs\n *\n3\\. Interactive Calculators\nOur online portal features calculators for:\n * Monthly budgeting and expense tracking\n * Comparing debt‐repayment strategies\n * Planning savings goals\n * Estimating mortgage affordability\n * Projecting retirement savings needs\n *\n4\\. Tutorials & Webinars\n * On‐Demand Video Tutorials: Core features of online/mobile banking, budgeting tools, credit‐report insights, and investing overviews.\n * Live Webinars: Regular sessions such as \"Master Your Budget,\" \"Credit Management Best Practices,\" and \"Investing in Volatile Markets.\"\n * In‐Branch Workshops: Hands‐on events covering budgeting boot camps, small‐business cash‐flow planning, and student financial wellness.\n *\n5\\. Downloadable Resources\nFind downloadable e‐books, whitepapers, templates, and checklists in our\nResources repository, covering:\n * Budget workbooks\n * Home‐buying guides\n * Debt‐reduction planners\n * Investment review checklists\n *\n6\\. Community & Support\n * Discussion Forum: Share tips and experiences with fellow customers.\n * Ask an Advisor: Monthly Q&A posts answered by our financial experts.\n * Financial Coaching: Schedule one‐on‐one virtual sessions with certified coaches.\n *\n7\\. Glossary of Terms\nA quick‐reference list of common financial terms to help you navigate our\nproducts and services:\n * APR (Annual Percentage Rate): The annual cost of borrowing, expressed as a percentage.\n * Amortization: The process of paying off debt over time through regular payments that cover both principal and interest.\n * Balance Transfer: Moving an outstanding balance from one credit card to another, often to take advantage of lower interest rates.\n * Collateral: An asset pledged by a borrower to secure a loan, which the lender can seize if the borrower defaults.\n * Compound Interest: Interest calculated on the initial principal and also on the accumulated interest of previous periods.\n * Credit Utilization Ratio: The percentage of available credit that is currently being used; impacts credit score.\n * Dividend: A portion of a company's earnings distributed to shareholders, typically as cash or additional shares.\n * Equity: The value of an owner's interest in an asset, calculated as the asset's market value minus liabilities.\n * Liquidity: The ease with which an asset can be converted into cash without affecting its market price.\n * Liquidity Ratio: A measure of a company's ability to meet short‐term obligations with its most liquid assets.\n * Minimum Payment: The lowest amount you must pay by the due date to keep your account in good standing.\n * NSF Fee (Non‐Sufficient Funds Fee): A charge applied when you attempt a transaction without enough funds in your account.\n * Overdraft Protection: A linked line of credit or account that covers transactions when your chequing account balance is insufficient.\n * Principal: The original sum of money borrowed or invested, excluding any interest or dividends.\n * Reward Points: Points earned through credit card or loyalty programs that can be redeemed for travel, merchandise, statement credits, and more.\n * Yield: The income return on an investment, expressed as a percentage of the investment's cost or current market value.\n *\n> For personalized guidance or technical assistance with any of these\n> resources, contact our Financial Education Team at\n> [financiallearning@mapletrustbank.ca](mailto:financiallearning@mapletrustbank.ca)\n> or call 1‐800‐MAPLE‐TR."
            }
        ]
    dummy_state = RAGState(
        session_id="testing",
        user_query="Tell me about Maple trust bank?",
        confluence_response=[],
        filtered_pages=[],
        vector_db_response=mock_response,
        answer="",
        cql_queries=[]
    )
    print(asyncio.run(agent_4_vector_db_filter_records(state=dummy_state)))


if __name__ == '__main__':
    #test_agent_2_search_vector_db()
    print("Starting code to be tested.")
    # test_agent_4_confluence_review_agent()
    # test_agent_1_generate_cql()
    #test_search_confluence()
    #test_agent4_vector_db_filter()

    #asyncio.run(search_confluence_with_cql_queries(['siteSearch ~ "Maple trust bank"']))
    #asyncio.run(get_tools())
